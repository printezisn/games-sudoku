(function(f,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(f=typeof globalThis<"u"?globalThis:f||self,u(f.sudoku={}))})(this,function(f){"use strict";var wt=Object.defineProperty;var mt=(f,u,p)=>u in f?wt(f,u,{enumerable:!0,configurable:!0,writable:!0,value:p}):f[u]=p;var r=(f,u,p)=>mt(f,typeof u!="symbol"?u+"":u,p);const u=(t,e,n=500,o=1e3)=>{let i=null,l=!1;return{start:()=>{i!=null&&clearTimeout(i),i=setTimeout(()=>{l=!0,i=null,t()},n)},cancel:()=>{i!=null&&(clearTimeout(i),i=null),l?i=setTimeout(()=>{l=!1,i=null,e()},o):e()}}};var p=(t=>(t[t.CELL_CHANGE=0]="CELL_CHANGE",t[t.COLOR_CHANGE=1]="COLOR_CHANGE",t))(p||{}),w=(t=>(t[t.EASY=0]="EASY",t[t.NORMAL=1]="NORMAL",t[t.HARD=2]="HARD",t[t.EMPTY=3]="EMPTY",t))(w||{}),y=(t=>(t[t.CREATE_NEW=0]="CREATE_NEW",t[t.SOLVE=1]="SOLVE",t))(y||{});const N=t=>{const e=JSON.stringify(t,(n,o)=>o instanceof Set?Array.from(o):o);localStorage.setItem("sudoku_board",e)},$=()=>{const t=localStorage.getItem("sudoku_board");return t?JSON.parse(t,(n,o)=>n==="options"?new Set(o):o):null},B=t=>{const e=[...t];for(let n=e.length-1;n>=0;n--){const o=Math.floor(Math.random()*(n+1)),i=e[o];e[o]=e[n],e[n]=i}return e},R=5,S={[w.EASY]:40,[w.NORMAL]:35,[w.HARD]:30,[w.EMPTY]:0},G=t=>({...t,actions:t.actions.map(e=>({...e})),cells:t.cells.map(e=>({...e,options:new Set(e.options)}))}),g=t=>{const e=Array(9).fill(null).map(()=>Array(10).fill(0)),n=Array(9).fill(null).map(()=>Array(10).fill(0)),o=Array(9).fill(null).map(()=>Array(10).fill(0));t.finished=!0;for(let i=0;i<t.cells.length;i++){const l=t.cells[i].value;if(!l)continue;const h=Math.floor(i/9),c=i%9,d=Math.floor(h/3)*3+Math.floor(c/3);e[h][l]++,n[c][l]++,o[d][l]++}for(let i=0;i<t.cells.length;i++){const l=t.cells[i],h=l.value,c=Math.floor(i/9),d=i%9,x=Math.floor(c/3)*3+Math.floor(d/3);l.options.clear();for(let a=1;a<=9;a++){const m=h===a?2:1;e[c][a]<m&&n[d][a]<m&&o[x][a]<m&&l.options.add(a)}l.hasError=h!=null&&!l.options.has(h),(l.hasError||h==null)&&(t.finished=!1)}},j=t=>{const e=(t.currentColor+1)%R;t.actions.push({cellIndex:null,from:t.currentColor,to:e,type:p.COLOR_CHANGE}),t.currentColor=e},P=(t,e,n)=>{t.actions.push({cellIndex:e,from:t.cells[e].value,to:n,type:p.CELL_CHANGE}),t.cells[e].value=n,t.cells[e].color=t.currentColor,g(t)},M=(t,e)=>{let n=!1;switch(e.type){case p.COLOR_CHANGE:t.currentColor=e.from;break;case p.CELL_CHANGE:t.cells[e.cellIndex].value=e.from,n=!0;break}return n},z=t=>{const e=t.actions.pop();e&&M(t,e)&&g(t)},Y=t=>{let e=!1;for(;t.actions.length>0;){const n=t.actions.pop();if(e=M(t,n)||e,n.type===p.COLOR_CHANGE)break}e&&g(t)},T=t=>{let e=-1;for(let o=0;o<t.cells.length;o++){const i=t.cells[o];i.value==null&&(e===-1||i.options.size<t.cells[e].options.size)&&(e=o)}if(e===-1)return g(t),t;const n=B(Array.from(t.cells[e].options));for(let o=0;o<n.length;o++){const i=Math.floor(e/9)*9,l=e%9,h=Math.floor(e/27)*27+Math.floor(l/3)*3,c=G(t);let d=!0;c.cells[e].value=n[o],c.cells[e].color=c.currentColor;for(let a=l;a<81+l&&d;a+=9)a!==e&&(c.cells[a].options.delete(n[o]),c.cells[a].options.size===0&&(d=!1));for(let a=i;a<i+9&&d;a++)a!==e&&(c.cells[a].options.delete(n[o]),c.cells[a].options.size===0&&(d=!1));for(let a=h;a<27+h&&d;a+=9)for(let m=a;m<a+3;m++)if(m!==e&&(c.cells[m].options.delete(n[o]),c.cells[m].options.size===0)){d=!1;break}if(!d)continue;const x=T(c);if(x)return x}return null},H=t=>{const e={cells:Array(81).fill(null).map(()=>({value:null,color:0,hasError:!1,initial:!1,options:new Set})),finished:!1,actions:[],currentColor:0};if(g(e),S[t]===0)return e;const n=T(e),o=B(n.cells);for(let i=0;i<o.length;i++)i<S[t]?(o[i].initial=!0,o[i].color=n.currentColor):o[i].value=null;return g(n),n};function V(t){return new Worker("/module-assets/worker-VWXZbi3g.js",{name:t==null?void 0:t.name})}const E="setGameLoading",b="updateGameBoard",_=new V;_.onmessage=t=>{const e=t.data;A.cancel(),e.board&&k(e.board)};const s=(()=>{const t=$();return{board:t||H(w.EMPTY),loading:!1,initialized:!!t}})(),A=u(()=>{s.loading=!0,window.dispatchEvent(new CustomEvent(E))},()=>{s.loading=!1,window.dispatchEvent(new CustomEvent(E))}),k=t=>{s.board=t,N(s.board),window.dispatchEvent(new CustomEvent(b))},v=t=>{s.loading||(A.start(),_.postMessage({type:y.CREATE_NEW,difficulty:t}))},D=()=>{s.initialized||v(w.EASY)},K=()=>{v(w.EASY)},W=()=>{v(w.NORMAL)},F=()=>{v(w.HARD)},J=()=>{s.loading||k(H(w.EMPTY))},U=()=>{s.loading||s.board.finished||(z(s.board),k(s.board))},q=()=>{s.loading||s.board.finished||(Y(s.board),k(s.board))},X=()=>{s.loading||(A.start(),_.postMessage({type:y.SOLVE,board:s.board}))},Z=()=>{s.loading||(j(s.board),k(s.board))},I=(t,e)=>{s.loading||(P(s.board,t,e),k(s.board))},Q=Object.freeze(Object.defineProperty({__proto__:null,changeColor:Z,initGame:D,newEasyGame:K,newEmptyGame:J,newHardGame:F,newNormalGame:W,solve:X,state:s,undoColor:q,undoOne:U,updateCell:I},Symbol.toStringTag,{value:"Module"})),tt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>',et='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rotate-ccw"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>',nt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',ot='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg>',O={colorIcon:"_colorIcon_1d7c5_1",actionButton:"_actionButton_1d7c5_6"},it=Q,st={"rotate-arrow":et,plus:nt,check:ot,changeColor:`<span class="${O.colorIcon}"></span>`};class rt extends HTMLElement{constructor(){super(...arguments);r(this,"menu","");r(this,"action","");r(this,"icon","");r(this,"button",document.createElement("button"));r(this,"hasClickedButton",!1);r(this,"onButtonClick",()=>{var n;this.button.ariaDisabled!=="true"&&(this.hasClickedButton=!0,this.menu&&this.button&&(this.button.ariaExpanded=this.button.ariaExpanded==="true"?"false":"true"),this.action&&(it[this.action](),(n=document.getElementById("sudoku-cell-0-0"))==null||n.focus()))});r(this,"onDocumentClick",()=>{this.hasClickedButton?this.hasClickedButton=!1:this.button&&(this.button.ariaExpanded="false")});r(this,"onDocumentKeyDown",n=>{n.key==="Escape"&&this.button.ariaExpanded==="true"&&(this.button.ariaExpanded="false",this.button.focus())});r(this,"setLoading",()=>{s.loading?(this.button.ariaDisabled="true",this.button.ariaExpanded="false"):this.button.ariaDisabled="false"});r(this,"setColor",()=>{this.button.setAttribute("data-color",s.board.currentColor.toString())})}connectedCallback(){this.classList.add(O.actionButton),this.action=this.getAttribute("action")??"",this.menu=this.getAttribute("menu")??"",this.icon=this.getAttribute("icon")??"",this.role="presentation",this.button=document.createElement("button"),this.button.type="button",this.button.role="menuitem",this.button.ariaDisabled="false",this.button.setAttribute("data-color",s.board.currentColor.toString()),this.button.classList.add("button"),this.menu&&(this.button.ariaHasPopup="true",this.button.setAttribute("aria-controls",this.menu),this.button.ariaExpanded="false"),window.addEventListener(E,this.setLoading),window.addEventListener(b,this.setColor),this.button.addEventListener("click",this.onButtonClick),this.menu&&(document.addEventListener("keydown",this.onDocumentKeyDown),document.addEventListener("click",this.onDocumentClick)),this.button.innerHTML=`${st[this.icon]??""}${this.innerHTML}${this.menu?tt:""}`,this.replaceChildren(this.button)}disconnectedCallback(){window.removeEventListener(E,this.setLoading),window.removeEventListener(b,this.setColor),this.button.removeEventListener("click",this.onButtonClick),this.menu&&(document.removeEventListener("keydown",this.onDocumentKeyDown),document.removeEventListener("click",this.onDocumentClick))}}const L={board:"_board_nmbl0_1",inner:"_inner_nmbl0_10",finished:"_finished_nmbl0_27"};class lt extends HTMLElement{constructor(){super(...arguments);r(this,"updateBoard",()=>{this.classList.toggle(L.finished,s.board.finished)})}connectedCallback(){this.classList.add(L.board),this.classList.toggle(L.finished,s.board.finished);const n=document.createElement("div");n.classList.add(L.inner);for(let o=0;o<9;o++){const i=document.createElement("div");for(let l=0;l<9;l++){const h=Math.floor(o/3)*3+Math.floor(l/3),c=o%3*3+l%3,d=document.createElement("app-sudoku-cell");d.setAttribute("row",h.toString()),d.setAttribute("col",c.toString()),i.appendChild(d)}n.appendChild(i)}this.appendChild(n),window.addEventListener(b,this.updateBoard)}disconnectedCallback(){window.removeEventListener(b,this.updateBoard)}}const C={cell:"_cell_d2i8u_1",initial:"_initial_d2i8u_40",error:"_error_d2i8u_47",finished:"_finished_d2i8u_50",right:"_right_d2i8u_69",top:"_top_d2i8u_73"};class at extends HTMLElement{constructor(){super(...arguments);r(this,"row",0);r(this,"col",0);r(this,"index",0);r(this,"button",document.createElement("button"));r(this,"dropdown",document.createElement("div"));r(this,"hasClickedButton",!1);r(this,"update",()=>{var n;this.button.classList.toggle(C.initial,s.board.cells[this.index].initial),this.button.classList.toggle(C.finished,s.board.finished),this.button.classList.toggle(C.error,s.board.cells[this.index].hasError),this.button.ariaLabel=this.getButtonLabel(),this.button.ariaInvalid=s.board.cells[this.index].hasError?"true":"false",this.button.innerHTML=((n=s.board.cells[this.index].value)==null?void 0:n.toString())??"",this.button.setAttribute("data-color",s.board.cells[this.index].color.toString()),this.button.ariaExpanded==="true"&&(this.dropdown.innerHTML=""),s.board.cells[this.index].initial||s.board.finished?(this.button.ariaExpanded=null,this.button.ariaHasPopup=null,this.button.removeAttribute("aria-controls")):(this.button.ariaExpanded="false",this.button.ariaHasPopup="true",this.button.setAttribute("aria-controls",this.dropdown.id))});r(this,"onButtonClick",()=>{this.button.ariaDisabled==="true"||this.button.ariaExpanded!=="false"||(this.hasClickedButton=!0,this.dropdown.innerHTML="",[null,1,2,3,4,5,6,7,8,9].forEach(n=>{const o=document.createElement("button");o.type="button",o.role="option",o.ariaSelected=s.board.cells[this.index].value===n?"true":"false",o.innerHTML=n===null?"-":n.toString(),this.dropdown.appendChild(o)}),this.button.ariaExpanded="true")});r(this,"onDocumentClick",()=>{this.hasClickedButton?this.hasClickedButton=!1:this.button.ariaExpanded==="true"&&this.update()});r(this,"onDropdownClick",n=>{const o=n.target;if((o==null?void 0:o.role)!=="option"||o.ariaDisabled==="true")return;const i=o.innerHTML==="-"?null:Number(o.innerHTML);I(this.index,i),this.button.focus()});r(this,"onKeyDown",n=>{n.key==="Escape"&&this.button.ariaExpanded==="true"&&(this.update(),this.button.focus())});r(this,"setLoading",async()=>{this.button.ariaDisabled=s.loading?"true":"false"});r(this,"getButtonLabel",()=>{const n=s.board.cells[this.index].value,o=n==null?"No number selected.":`${n} is selected.`,i=`Sudoku cell row ${this.row+1} and column ${this.col+1}. ${o}`;return s.board.cells[this.index].initial?`${i} The number cannot be changed.`:`${i} Click to select a number.`});r(this,"initButton",()=>{this.button.id=`sudoku-cell-${this.row}-${this.col}`,this.button.type="button",this.button.ariaDisabled="false",this.appendChild(this.button)});r(this,"initDropdown",()=>{this.dropdown.id=`sudoku-cell-dropdown-${this.row}-${this.col}`,this.dropdown.role="listbox",this.dropdown.ariaLabel="Cell options",this.dropdown.classList.toggle(C.right,this.col>4),this.dropdown.classList.toggle(C.top,this.row>5),this.appendChild(this.dropdown)})}connectedCallback(){this.classList.add(C.cell),this.row=Number(this.getAttribute("row")),this.col=Number(this.getAttribute("col")),this.index=this.row*9+this.col,this.initButton(),this.initDropdown(),this.update(),window.addEventListener(E,this.setLoading),window.addEventListener(b,this.update),this.button.addEventListener("click",this.onButtonClick),document.addEventListener("click",this.onDocumentClick),this.dropdown.addEventListener("click",this.onDropdownClick),document.addEventListener("keydown",this.onKeyDown)}disconnectedCallback(){window.removeEventListener(E,this.setLoading),window.removeEventListener(b,this.update),this.button.removeEventListener("click",this.onButtonClick),document.removeEventListener("click",this.onDocumentClick),this.dropdown.removeEventListener("click",this.onDropdownClick),document.removeEventListener("keydown",this.onKeyDown)}}const ct='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>',dt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>';class ut extends HTMLElement{constructor(){super(...arguments);r(this,"switch",null);r(this,"onSwitchChange",()=>{this.switch&&(this.switch.ariaChecked=this.switch.ariaChecked==="true"?"false":"true",document.documentElement.setAttribute("data-theme",this.switch.ariaChecked==="true"?"dark":"light"),localStorage.setItem("sudoku_theme",this.switch.ariaChecked==="true"?"dark":"light"))})}connectedCallback(){let n=localStorage.getItem("sudoku_theme");n||(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),this.switch=document.createElement("button"),this.switch.type="button",this.switch.role="switch",this.switch.ariaLabel="Enable dark theme",this.switch.ariaChecked=n==="dark"?"true":"false",this.switch.innerHTML=`${ct}${dt}`,this.switch.addEventListener("click",this.onSwitchChange),this.appendChild(this.switch)}disconnectedCallback(){var n;(n=this.switch)==null||n.removeEventListener("click",this.onSwitchChange)}}const ht={"arrow-left":'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>'},ft=()=>{Array.from(document.querySelectorAll("[data-icon]")).forEach(t=>{const e=ht[t.getAttribute("data-icon")??""];t.innerHTML=`${e}${t.innerHTML}`})},pt=()=>{customElements.define("app-theme-switch",ut),customElements.define("app-action-button",rt),customElements.define("app-sudoku-board",lt),customElements.define("app-sudoku-cell",at),D(),ft(),setTimeout(()=>{document.getElementsByClassName("curtain")[0].classList.remove("curtain")},0)};f.init=pt,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
